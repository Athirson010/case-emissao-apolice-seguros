{
  "metadata": {
    "document_type": "PDF - Desafio Técnico Software Engineer (Seguradora)",
    "source_files": [
      "desafio_software_engineer_seguradora_v2.pdf"
    ],
    "notes": "Contexto de validação focado explicitamente no ciclo de vida da solicitação de apólice e suas regras de transição de estados, conforme trecho destacado pelo usuário. Este conteúdo deve ser usado como prompt para validar a implementação da aplicação."
  },
  "context": {
    "summary": "Este contexto descreve de forma explícita e normativa todas as validações relacionadas ao ciclo de vida da solicitação de apólice. Cada estado possui regras claras de entrada, saída, bloqueios e condições obrigatórias, que devem ser rigorosamente respeitadas pela aplicação.",
    "state_lifecycle_validations": [
      {
        "state": "RECEIVED",
        "entry_validation": "Toda solicitação DEVE iniciar obrigatoriamente no estado RECEIVED no momento da criação.",
        "allowed_transitions": [
          "VALIDATED",
          "CANCELLED"
        ],
        "forbidden_transitions": [
          "PENDING",
          "APPROVED",
          "REJECTED"
        ],
        "process_validations": [
          "Os dados iniciais da solicitação devem ser coletados e persistidos neste estado.",
          "A solicitação deve aguardar obrigatoriamente a análise da API de Fraudes antes de qualquer outra transição.",
          "Nenhuma regra de capital segurado pode ser aplicada antes do retorno da API de Fraudes."
        ]
      },
      {
        "state": "VALIDATED",
        "entry_validation": "Este estado só pode ser alcançado após consulta bem-sucedida à API de Fraudes.",
        "allowed_transitions": [
          "PENDING",
          "REJECTED"
        ],
        "forbidden_transitions": [
          "APPROVED",
          "CANCELLED"
        ],
        "process_validations": [
          "A classificação de risco retornada pela API de Fraudes DEVE ser uma das seguintes: REGULAR, HIGH_RISK, PREFERENTIAL, NO_INFORMATION.",
          "As regras de capital segurado DEVEM ser aplicadas conforme o perfil de risco do cliente.",
          "Caso qualquer regra de validação por perfil seja violada, a solicitação DEVE ser rejeitada."
        ]
      },
      {
        "state": "PENDING",
        "entry_validation": "Este estado só pode ser alcançado após validação positiva das regras de negócio no estado VALIDATED.",
        "allowed_transitions": [
          "APPROVED",
          "REJECTED",
          "CANCELLED",
          "PENDING"
        ],
        "forbidden_transitions": [
          "RECEIVED",
          "VALIDATED"
        ],
        "process_validations": [
          "A solicitação deve permanecer neste estado até receber evento de confirmação de pagamento E autorização de subscrição.",
          "Reprocessamentos podem ocorrer mantendo o estado como PENDING.",
          "Eventos externos devem ser correlacionados corretamente com o ID da solicitação."
        ]
      },
      {
        "state": "REJECTED",
        "entry_validation": "Pode ser alcançado se regras de negócio não forem atendidas OU se pagamento OU subscrição forem negados.",
        "allowed_transitions": [],
        "forbidden_transitions": [
          "RECEIVED",
          "VALIDATED",
          "PENDING",
          "APPROVED",
          "CANCELLED"
        ],
        "process_validations": [
          "Este é um estado final.",
          "Após rejeição, nenhuma nova alteração de estado é permitida.",
          "A rejeição deve ser registrada no histórico com data/hora."
        ]
      },
      {
        "state": "APPROVED",
        "entry_validation": "Somente pode ser alcançado após confirmação de pagamento E autorização de subscrição.",
        "allowed_transitions": [],
        "forbidden_transitions": [
          "RECEIVED",
          "VALIDATED",
          "PENDING",
          "REJECTED",
          "CANCELLED"
        ],
        "process_validations": [
          "Este é um estado final.",
          "Uma solicitação aprovada NÃO pode ser cancelada.",
          "A data/hora de finalização deve ser registrada."
        ]
      },
      {
        "state": "CANCELLED",
        "entry_validation": "Pode ser acionado pelo cliente a qualquer momento, exceto se a solicitação já estiver APPROVED ou REJECTED.",
        "allowed_transitions": [],
        "forbidden_transitions": [
          "RECEIVED",
          "VALIDATED",
          "PENDING",
          "APPROVED",
          "REJECTED"
        ],
        "process_validations": [
          "Este é um estado final.",
          "Após cancelamento, nenhuma outra transição é permitida.",
          "O cancelamento deve ser registrado no histórico com data/hora."
        ]
      }
    ],
    "cross_state_validations": [
      {
        "rule": "Toda transição de estado deve ser validada contra o estado atual da solicitação."
      },
      {
        "rule": "Transições inválidas devem ser rejeitadas com erro claro (ex: HTTP 409 ou 422)."
      },
      {
        "rule": "Toda mudança de estado deve gerar registro no histórico e evento de mensageria."
      },
      {
        "rule": "Estados finais (APPROVED, REJECTED, CANCELLED) encerram definitivamente o ciclo de vida."
      }
    ]
  },
  "contradictions_or_conflicts": [],
  "errors_or_warnings": [
    {
      "issue_type": "state_machine_strictness",
      "description": "O desafio exige uma máquina de estados estrita, mas não define tratamento padrão para eventos fora de ordem.",
      "proposed_solution": "Validar se a aplicação ignora ou rejeita eventos incompatíveis com o estado atual."
    }
  ]
}
